version: "3.1"

intents:
  - greet
  - bot_challenge
  - goodbye
  - ask_event_info
  - ask_circuit_info
  - ask_event_schedule
  - ask_race_winner
  - ask_weather_info
  - ask_fastest_lap
  - inform
  - compare_drivers_telemetry
  - show_speed_map
  - stop
  - chitchat
  - faq

channels:
  - telegram
  - rest
forms:
  fastest_lap_form:
    required_slots:
      - gp
      - year
  event_schedule_form:
    required_slots:
      - gp
      - year
  telemetry_form:
    required_slots:
      - gp
      - year
      - driver_1
      - driver_2

actions:
  - action_get_event_info
  - action_get_circuit_info
  - action_get_event_schedule
  - action_get_race_winner
  - action_get_weather_info
  - action_get_fastest_lap
  - action_ask_missing_gp
  - action_ask_missing_year
  - utter_ask_year
  - action_compare_telemetry
  - action_show_speed_map
  - utter_ask_gp
  - action_reset_slots
  - validate_fastest_lap_form

responses:

  utter_greet:
    - text: "Ciao! Sono il tuo assistente F1. Come posso aiutarti?"
    - text: "Ciao! Come posso aiutarti con le informazioni sulla Formula 1? üòä"
    - text: "Buongiorno! Chiedimi qualcosa sulla Formula 1! üòä"
    - text: "Ehi! Posso esserti utile per le informazioni sulla Formula 1? üòä"

  utter_bot_challenge:
    - text: "Sono un assistente virtuale per aiutarti con le info sulla Formula 1! ü§ñüèéÔ∏è"
    - text: "Sono un bot con molte informazioni sulla Formula 1 pronte per te! ü§ñüèéÔ∏è"

  utter_goodbye:
    - text: "Arrivederci! A presto! üëã"
    - text: "Ciao! Torna presto se hai bisogno. üòä"
    - text: "Alla prossima! üëã"

  utter_circuit_info:
    - text: "Ecco alcune informazioni sul circuito di {gp}:"
    - text: "Parliamo del circuito di {gp}, dammi un secondo..."

  utter_ask_driver:
  - text: "Per quale pilota vuoi sapere le informazioni?"

  utter_ask_gp:
    - text: "Per quale GP vuoi sapere il programma delle sessioni?"

  utter_ask_year:
    - text: "Per quale anno vuoi sapere il programma?"

  utter_stop:
    - text: "Va bene, interrompo la richiesta. Posso aiutarti con qualcos'altro?"

  utter_chitchat/come_stai:
    - text: "Sto bene, grazie! Pronto ad aiutarti con la Formula 1!"
    - text: "Tutto bene, grazie della domanda! Come posso aiutarti?"

  utter_chitchat/chi_sei:
    - text: "Sono un assistente specializzato in Formula 1, pronto ad aiutarti!"
    - text: "Sono il tuo assistente F1, posso aiutarti con informazioni sui circuiti e le gare!"

  utter_faq/regole:
    - text: "La Formula 1 ha un complesso set di regole. Quale aspetto specifico ti interessa?"

  utter_faq/punti:
    - text: "Nel sistema di punteggio attuale: 1¬∞ posto: 25 punti, 2¬∞: 18 punti, 3¬∞: 15 punti, e cos√¨ via."

  utter_ask_more:
    - text: "C'√® altro che vuoi sapere?"
    - text: "Posso aiutarti con qualcos'altro?"

entities:
  - gp
  - year
  - session
  - driver_1
  - driver_2
  - driver

slots:
  gp:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: gp
  
  year:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: year

  session:
    type: text
    mappings:
    - type: from_entity
      entity: session
    - type: from_text
      conditions:
      - active_loop: null
        requested_slot: session
  gp_valid:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  
  driver:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: driver
  driver_1:
    type: text
    mappings:
    - type: from_entity
      entity: driver_1
  driver_2:
    type: text
    mappings:
    - type: from_entity
      entity: driver_2

  requested_slot:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  fastest_lap_done:
    type: bool
    influence_conversation: false
    mappings:
      - type: custom

  action_executed:
    type: bool
    influence_conversation: false
    mappings:
    - type: custom

rules:
  - rule: Ask circuit info
    steps:
    - intent: ask_circuit_info
    - action: action_get_circuit_info
    - action: action_listen

  - rule: Ask event schedule
    steps:
    - intent: ask_event_schedule
    - action: event_schedule_form
    - active_loop: event_schedule_form

  - rule: Submit event schedule form
    condition:
    - active_loop: event_schedule_form
    steps:
    - action: event_schedule_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_get_event_schedule
    - action: action_listen

  - rule: Get event schedule with missing year
    condition:
    - active_loop: null
    - slot_was_set:
        - requested_slot: year
    - slot_was_set:
        - gp: any
    steps:
    - intent: inform
      entities:
      - year
    - action: action_get_event_schedule
    - action: action_listen

  - rule: Get event schedule with missing GP
    condition:
    - active_loop: null
    - slot_was_set:
        - requested_slot: gp
    - slot_was_set:
        - year: any
    steps:
    - intent: inform
      entities:
      - gp
    - action: action_get_event_schedule
    - action: action_listen

  - rule: Get event schedule complete
    condition:
    - active_loop: null
    steps:
    - intent: ask_event_schedule
    - action: action_get_event_schedule

  - rule: Activate telemetry form
    steps:
    - intent: compare_drivers_telemetry
    - action: telemetry_form
    - active_loop: telemetry_form

  - rule: Submit telemetry form
    condition:
    - active_loop: telemetry_form
    steps:
    - action: telemetry_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_compare_telemetry
    - action: action_listen




